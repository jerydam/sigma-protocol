"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9276],{39276:(e,a,n)=>{n.r(a),n.d(a,{AwaitingEvmToSolBridgingScreen:()=>B,default:()=>B});var t=n(73788),i=n(79259),s=n(65936),r=n(39241),o=n(55095),d=n(50244),c=n(9587),l=n(92658),u=n(58813),g=n(19722),h=n(72853),f=n(74124),m=n(64252),p=n(87288),v=n(66656),S=n(75187),b=n(86249),C=n(41196),T=n(79312),y=n(66428),w=n(97365),I=n(16756),E=n(66279),N=n(94968),x=n(35459),F=n(63461),A=n(71968),P=n(36983),U=n(15400);n(30404),n(28349),n(7764),n(32709),n(57668);let B={component:()=>{let e=(0,S.u)(),{rpcConfig:a,appId:n,closePrivyModal:B,createAnalyticsEvent:D}=(0,b.u)(),{navigate:k,setModalData:L,data:M}=(0,T.a)(),j=(0,S.u)(),{wallets:q}=(0,w.u)(),[H,J]=(0,s.useState)(null),[R,V]=(0,s.useState)(null),[W,Z]=(0,s.useState)([]),[$,G]=(0,s.useState)(0),[Y,O]=(0,s.useState)(!1),[Q,z]=(0,s.useState)(!1),[_,K]=(0,s.useState)(!1),[X,ee]=(0,s.useState)(!1),[ea,en]=(0,s.useState)(),[et,ei]=(0,s.useState)();if(!M?.funding||"solana"!==M.funding.chainType)throw Error("Invalid funding data");let{address:es,chain:er,connectedWallet:eo}=M.funding,[ed,ec]=(0,s.useState)(M.funding.amount),el=("ethereum"===eo?.type?eo:void 0)??q[0],eu=(0,C.Q)(el?.walletClientType||"unknown"),eg=eu?.name||"wallet",[eh,ef]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{if(!el)return;let e=await el.getEthereumProvider();ef((0,r.F)({account:el.address,transport:(0,o.I)(e)}).extend(d.$))})().catch(console.error)},[el]);let[em,ep]=(0,s.useState)(0n),ev=(0,F.g)(em);(0,s.useEffect)(()=>{let a=e.solanaRpcs[er];a?(0,N.x)({rpc:a.rpc,address:es}).then(e=>ep(BigInt(e))).catch(console.error):console.warn("Unable to load solana rpc, skipping balance")},[]);let[eS,eb]=(0,s.useState)(),{tokenPrice:eC}=(0,y.u)("solana"),{fundingAmountInBaseUnit:eT,fundingAmountInUsd:ey}=(0,F.a)({amount:ed,fee:0n,tokenPrice:eC,isUsdc:M.funding.isUSDC});if((0,s.useEffect)(()=>{(async()=>{if(!eh||!el)return;let e=["solana:testnet","solana:devnet"].includes(er);e&&console.warn("Solana testnets are not supported for bridging");let t=(0,g.u)(j.chains).filter(({testnet:a})=>!!a===e),i=(await (0,A.g)({chains:t,address:el.address,appId:n,rpcConfig:a})).filter(e=>e.balance>0n);if(i.length<1)return void J(new b.a(`Wallet ${(0,C.D)(el.address)} does not have enough funds.`,void 0,b.b.INSUFFICIENT_BALANCE));i.sort((e,a)=>Number(a.balance-e.balance));let s=(await Promise.allSettled(i.map(async e=>({...e,quote:await (0,E.g)({isTestnet:!1,input:(0,E.t)({appId:n,amount:eT.toString(),user:el.address,recipient:es,destinationChainId:E.b,destinationCurrency:E.a,originChainId:e.chain.id})})})))).filter(e=>"fulfilled"===e.status).map(e=>e.value);if(s.length<1)return void J(new b.a(`Unable to fetch quotes for bridging. Wallet ${(0,C.D)(el.address)} does not have enough funds.`,void 0,b.b.INSUFFICIENT_BALANCE));let r=s.map(({quote:e,balance:a,chain:n})=>({bridgeTx:(0,E.c)(e),balance:a,chain:n,isErc20Quote:!1})).filter(({bridgeTx:e})=>!!e);if(r.length>1)return void Z(r);let o=r.at(0);o?(z(!0),eb({data:o.bridgeTx.data,to:o.bridgeTx.to,value:o.bridgeTx.value,chain:o.chain})):J(new b.a(`Unable to select bridge option from quotes. Wallet ${(0,C.D)(el.address)} does not have enough funds.`,void 0,b.b.INSUFFICIENT_BALANCE))})().catch(console.error)},[eh]),(0,s.useEffect)(()=>{(async()=>{let e,t;if(!eh||!el||Y||_||!eS)return;O(!0);let i=(0,c.l)({chain:eS.chain,transport:(0,l.L)((0,P.a)(eS.chain,a,n))});try{e=await i.prepareTransactionRequest({account:el.address,to:eS.to,chain:eS.chain,data:eS.data,value:BigInt(eS.value??0)})}catch(e){console.error(e),W.length>1&&V(e.shortMessage??"Something went wrong")}if(e){O(!1),K(!0);try{await eh.switchChain({id:eS.chain.id})}catch(e){await eh.addChain({chain:eS.chain}),await eh.switchChain({id:eS.chain.id})}try{t=await eh.sendTransaction(e)}catch(e){console.error(e),"TransactionExecutionError"===e.name&&(W.length<1?J(new b.a(e.shortMessage,void 0,b.b.TRANSACTION_FAILURE)):V(e.shortMessage??"Something went wrong"))}if(t)return await eh.waitForTransactionReceipt({hash:t}),Q?(ei("pending"),void en(t)):(K(!1),ee(!0),void D({eventName:I.O,payload:{provider:"external",status:"success",txHash:t,address:el.address,chainId:eS.chain.id,chainType:"ethereum",value:eS.value?(0,u.J)(BigInt(eS.value),18):void 0,token:"ETH",destination:es,destinationClusterName:"mainnet-beta",destinationChainType:"solana",destinationValue:(0,u.J)(eT,9),destinationToken:"SOL"}}));K(!1)}else O(!1)})().catch(console.error)},[eh,eS]),(0,E.u)({transactionHash:ea,isTestnet:!1,bridgingStatus:et,setBridgingStatus:ei,onSuccess({transactionHash:e}){z(!1),ee(!0),D({eventName:I.O,payload:{provider:"external",status:"success",txHash:e,address:el?.address,chainId:eS?.chain.id,chainType:"ethereum",value:eS?.value?(0,u.J)(BigInt(eS.value),18):void 0,token:"ETH",destination:es,destinationClusterName:"mainnet-beta",destinationChainType:"solana",destinationValue:(0,u.J)(eT,9),destinationToken:"SOL"}})},onFailure({error:e}){z(!1),J(e)}}),(0,s.useEffect)(()=>{H&&(L({funding:M?.funding,solanaFundingData:M?.solanaFundingData,sendTransaction:M?.sendTransaction,errorModalData:{error:H,previousScreen:"TransferFromWalletScreen"}}),k("ErrorScreen",!1))},[H]),(0,s.useEffect)(()=>{if(!X)return;let e=setTimeout(B,S.t);return()=>clearTimeout(e)},[X]),X)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.t,{}),(0,t.jsx)(h.b,{}),(0,t.jsxs)(h.c,{children:[(0,t.jsx)(i.A,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),(0,t.jsx)(m.C,{title:"Success!",description:`Youâ€™ve successfully added ${ed} SOL to your ${j.name} wallet. It may take a minute before the funds are available to use.`})]}),(0,t.jsx)(h.R,{}),(0,t.jsx)(f.B,{})]});let ew=W[$];return W.length>1&&ew?(0,t.jsx)(A.B,{displayName:eg,configuredFundingChain:er,formattedBalance:ev,fundingAmount:ed,fundingCurrency:"SOL",fundingAmountInUsd:ey,options:W,selectedOption:ew,isPreparing:Y,isSubmitting:_,addressToFund:es,fundingWalletAddress:el?.address||"",errorMessage:R,onSubmit:()=>{M.funding?.amount!==ed?(async function(){if(el&&ew)try{let e=await (0,E.g)({isTestnet:!1,input:(0,E.t)({appId:n,amount:eT.toString(),user:el.address,recipient:es,destinationChainId:E.b,destinationCurrency:E.a,originChainId:ew.chain.id})}),a=(0,E.c)(e);if(!a)throw Error("Invalid transaction request");z(!0),eb({data:a.data,to:a.to,value:a.value,chain:ew.chain})}catch(e){console.error(e),J(new b.a("Unable to fetch quotes for bridging",e,b.b.INSUFFICIENT_BALANCE))}})().catch(console.error):eb({to:ew.bridgeTx.to,data:ew.bridgeTx.data,value:ew.bridgeTx.value,chain:ew.chain})},onSelect:e=>{e!==$&&(V(null),G(e))},onAmountChange:ec}):_&&el?(0,t.jsx)(U.T,{walletClientType:el?.walletClientType||"unknown",displayName:eg,addressToFund:es,isBridging:Q,isErc20Flow:!1,chainId:"solana",chainName:(0,x.g)(er),totalPriceInUsd:void 0,totalPriceInNativeCurrency:void 0,gasPriceInUsd:void 0,gasPriceInNativeCurrency:void 0}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.t,{}),(0,t.jsx)(v.N,{}),(0,t.jsx)("div",{style:{marginTop:"1rem"}}),(0,t.jsx)(f.B,{})]})}}},48507:(e,a,n)=>{n.d(a,{A:()=>o,D:()=>l,J:()=>c,L:()=>t,R:()=>d,S:()=>i,T:()=>s,a:()=>r,g:()=>u});let t=1e9,i="11111111111111111111111111111111",s="TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",r="TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb",o="ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL",d=["CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C","CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"],c=["JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4"],l={"solana:mainnet":{EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v:{symbol:"USDC",decimals:6,address:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"},Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB:{symbol:"USDT",decimals:6,address:"Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"},So11111111111111111111111111111111111111112:{symbol:"SOL",decimals:9,address:"So11111111111111111111111111111111111111112"}},"solana:devnet":{"4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU":{symbol:"USDC",decimals:6,address:"4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU"},EJwZgeZrdC8TXTQbQBoL6bfuAnFUUy1PVCMB4DYPzVaS:{symbol:"USDT",decimals:6,address:"EJwZgeZrdC8TXTQbQBoL6bfuAnFUUy1PVCMB4DYPzVaS"},So11111111111111111111111111111111111111112:{symbol:"SOL",decimals:9,address:"So11111111111111111111111111111111111111112"}},"solana:testnet":{}};function u(e,a){let n=parseFloat(e.toString())/t,i=g.format(a*n);return"$0.00"===i?"<$0.01":i}let g=new Intl.NumberFormat(void 0,{style:"currency",currency:"USD",maximumFractionDigits:2})},63461:(e,a,n)=>{n.d(a,{a:()=>s,g:()=>i});var t=n(48507);function i(e,a=6,n=!1,t=!1){let s=(parseFloat(e.toString())/1e9).toFixed(a).replace(/0+$/,"").replace(/\.$/,""),r=t?"":" SOL";return n?`${s}${r}`:`${"0"===s?"<0.001":s}${r}`}function s({amount:e,fee:a,tokenPrice:n,isUsdc:s}){let r=BigInt(Math.floor(parseFloat(e)*10**(s?6:9))),o=s?r:r+a;return{fundingAmountInBaseUnit:r,fundingAmountInUsd:n?(0,t.g)(r,n):void 0,totalPriceInUsd:n?(0,t.g)(o,n):void 0,totalPriceInNativeCurrency:i(o),feePriceInNativeCurrency:i(a),feePriceInUsd:n?(0,t.g)(a,n):void 0}}}}]);