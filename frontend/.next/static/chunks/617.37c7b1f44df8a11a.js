"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[617],{20617:(e,s,r)=>{r.r(s),r.d(s,{EmbeddedWalletPasswordUpdateScreen:()=>c,default:()=>c});var t=r(73788),a=r(65936),o=r(79312),d=r(75187),n=r(86249),l=r(97365),i=r(51273);r(30404),r(28349),r(7764),r(81055),r(83726);let c={component:()=>{let[e,s]=(0,a.useState)(null),[r,c]=(0,a.useState)(!1),[w,y]=(0,a.useState)(null),[u,v]=(0,a.useState)(""),{authenticated:p,user:g}=(0,o.u)(),{client:h,walletProxy:_,refreshSessionAndUser:m,closePrivyModal:f,createAnalyticsEvent:M}=(0,n.u)(),{navigate:b,data:R,onUserCloseViaDialogOrKeybindRef:P}=(0,o.a)(),A=(0,d.u)(),{onSuccess:S,onFailure:E}=R.setWalletPassword,C=(0,o.g)(g),N="user-passcode"===e?.recoveryMethod,x="user-passcode"===C?.recoveryMethod;(0,a.useEffect)(()=>{p||(b("LandingScreen"),E(new n.o("User must be authenticated before setting a password on a Privy wallet")))},[p]);let k=()=>(w?E(w):N?S(e):E(new n.m("Exited before password was added to wallet")),void f({shouldCallAuthOnSuccess:!1}));return P.current=k,(0,t.jsx)(i.S,{appName:A?.name||"privy",config:{initiatedBy:"user",onCancel:k},error:w?"An error has occurred, please try again.":void 0,buttonLoading:r,buttonHideAnimations:!1,password:u,isResettingPassword:x,onPasswordGenerate:()=>v((0,i.g)()),onPasswordChange:v,onSubmit:async()=>{N?(S(e),f({shouldCallAuthOnSuccess:!1})):(c(!0),y(null),await (async()=>{let e=await h.getAccessToken();if(e&&g&&C?.address&&u&&_)try{M({eventName:"embedded_wallet_set_recovery_started",payload:{walletAddress:C.address,existingRecoveryMethod:C.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:x}});let{entropyId:r,entropyIdVerifier:t}=(0,l.g)(g);if(!(await _.setRecovery({accessToken:e,entropyId:r,entropyIdVerifier:t,recoveryPassword:u,recoveryMethod:"user-passcode"})).entropyId)return y(new n.m("Error setting password on privy wallet")),void M({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:C.address,existingRecoveryMethod:C.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:x,reason:"error setting password"}});let a=await m(),d=(0,o.g)(a);if(!d)return y(new n.m("Error setting password on privy wallet")),void M({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:C.address,existingRecoveryMethod:C.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:x,reason:"wallet disconnected"}});s(d),M({eventName:"embedded_wallet_set_recovery_completed",payload:{walletAddress:C.address,existingRecoveryMethod:C.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:x}})}catch(e){console.warn(e),y(e instanceof Error?e:Error("Error setting password on privy wallet")),M({eventName:"embedded_wallet_set_password_failed",payload:{walletAddress:C.address,reason:e}})}})(),c(!1))},onClose:k})}}}}]);