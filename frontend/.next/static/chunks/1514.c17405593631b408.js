"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1514],{11514:(e,s,t)=>{t.r(s),t.d(s,{MfaAuthVerifyFlowScreen:()=>l,default:()=>l});var r=t(73788),o=t(65936),a=t(75187),i=t(79312),n=t(37170);t(30404),t(28349),t(7764),t(32709),t(57668);let l={component:()=>{let{user:e}=(0,i.u)(),s=(0,a.u)(),t=(0,o.useMemo)(()=>e?.mfaMethods.filter(e=>"passkey"!==e||!s.globalDisablePasskeys)??[],[e?.mfaMethods,s.globalDisablePasskeys]),{data:l}=(0,i.a)(),[c,f]=(0,o.useState)(t[0]),[u,d]=(0,o.useState)(!1),[h,y]=(0,o.useState)(),[k,m]=(0,o.useState)();if((0,o.useEffect)(()=>{f(t[0])},[t]),!l?.mfaVerify)throw Error("Missing modal data for MFA verification screen.");let{onFailure:p,onSuccess:v,generateOptions:w,verifyTotpCode:g,verifyPasskey:S,verifySmsCode:b,sendSmsCode:M}=l.mfaVerify,C=async e=>{if("passkey"!==e)try{f(e),"sms"===e&&(f(e),await M()),"totp"===e&&f(e)}catch(e){console.error(e)}else try{f(e);let s=await w();if(!s)throw Error("something went wrong");y(s),await S(s),d(!0),m(void 0),v()}catch(e){m((0,n.t)(e))}},E=async e=>{m(void 0);try{if(!e||!c)return;if("passkey"===c){if(!h)throw Error("Missing passkey challenge");await S(h)}else"sms"===c?await b(e):"totp"===c&&await g(e);m(void 0),d(!0),v()}catch(e){throw(0,n.t)(e).error}},A=()=>{k||!u?p(k?.error??Error("Canceled MFA verification.")):v()},B=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{!B.current&&c&&(B.current=!0,C(c).finally(()=>{B.current=!1}))},[open]),e?"passkey"===c?(0,r.jsx)(n.V,{account:e.linkedAccounts.filter(e=>"passkey"===e.type&&e.enrolledInMfa).sort((e,s)=>s.firstVerifiedAt.valueOf()-e.firstVerifiedAt.valueOf())[0],submitSuccess:u,hasBlockingError:k?.isBlocking??!1,error:k?.error,onClose:A,onBack:()=>{f(void 0),m(void 0)},handleSubmit:()=>E(h).catch(m)}):"sms"===c||"totp"===c?(0,r.jsx)(n.a,{selectedMethod:c,submitSuccess:u,hasBlockingError:k?.isBlocking??!1,handleSubmitCode:E,onClose:A,onBack:t.length>1?()=>f(void 0):void 0}):(0,r.jsx)(n.b,{mfaMethods:t,onSelect:C,handleClose:A}):null}}}}]);