"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4383],{4383:(e,t,r)=>{r.r(t),r.d(t,{RecoveryOAuthScreen:()=>x,default:()=>x});var a=r(73788),o=r(65936),i=r(74124),l=r(64252),n=r(75187),c=r(94968),s=r(86249),d=r(79312),h=r(5974),p=r(97365),u=r(31189),v=r(99640);async function w({url:e,popup:t,provider:r}){return t.location=e,new Promise((e,r)=>{function a(){t?.close(),window.removeEventListener("message",o)}function o(t){t.data&&("PRIVY_OAUTH_RESPONSE"===t.data.type&&t.data.stateCode&&t.data.authorizationCode&&(e(t.data),a()),"https://cdn.apple-cloudkit.com"===t.origin&&t.data.ckSession&&(e({type:"PRIVY_OAUTH_RESPONSE",ckWebAuthToken:t.data.ckSession}),a()),"PRIVY_OAUTH_ERROR"===t.data.type&&(r(t.data.error),a()))}window.addEventListener("message",o)})}async function y({api:e,provider:t,stateCode:r,codeVerifier:a,authorizationCode:o}){if(!o||!r)throw new s.a("[OAuth AuthFlow] Authorization and state codes code must be set prior to calling authenicate.");if("undefined"===o)throw new s.a("User denied confirmation during OAuth flow");try{return(await e.post(h.a8,{authorization_code:o,state_code:r,code_verifier:a,provider:t})).access_token}catch(t){let e=(0,s.f)(t);if(e.privyErrorCode)throw new s.a(e.message||"Invalid code during OAuth flow.",void 0,e.privyErrorCode);if("User denied confirmation during OAuth flow"===e.message)throw new s.a("Invalid code during oauth flow.",void 0,s.b.OAUTH_USER_DENIED);throw new s.a("Invalid code during OAuth flow.",void 0,s.b.UNKNOWN_AUTH_ERROR)}}async function f({api:e,provider:t}){let r=(0,c.o)(),a=(0,c.q)(),o=await (0,c.r)(r);try{return"icloud"===t?{url:(await e.post(h.a9,{client_type:"web"})).url}:{url:(await e.post(h.aa,{redirect_to:window.location.href,code_challenge:o,state_code:a})).url,codeVerifier:r,stateCode:a,provider:t}}catch(e){throw(0,s.f)(e)}}r(28349),r(7764),r(30404),r(32709),r(57668);let g={"google-drive":{name:"Google Drive",component:v.G},icloud:{name:"iCloud",component:v.A}},x={component:()=>{let{logout:e}=(0,d.u)(),{navigate:t,setModalData:r,data:h}=(0,d.a)(),{closePrivyModal:x,createAnalyticsEvent:m}=(0,s.u)(),{execute:_}=(()=>{let{client:e,walletProxy:t,refreshSessionAndUser:r}=(0,s.u)(),{data:a}=(0,d.a)(),{user:o}=(0,d.u)(),i=(0,u.a)(),{create:l}=(0,c.v)();return{execute:async({provider:n,action:c,popup:h,shouldCreateEth:u,shouldCreateSol:v})=>{let g,x;if(!e)throw new s.a("Missing client");function m(t){if(!t&&e)throw e.createAnalyticsEvent({eventName:"recovery_oauth_error",payload:{error:"Unable to open recovery OAuth popup",provider:n}}),new s.a("Recovery OAuth failed")}switch(n){case"google-drive":{let t,r,{url:a,codeVerifier:o,stateCode:i}=await f({api:e.api,provider:n});m(a);try{let o=await w({url:a,popup:h,provider:n});if(t=o.stateCode,r=o.authorizationCode,t!==i)throw e.createAnalyticsEvent({eventName:"possible_phishing_attempt",payload:{provider:n,storedStateCode:i??"",returnedStateCode:t??""}}),new s.a("Unexpected auth flow. This may be a phishing attempt.",void 0,s.b.OAUTH_UNEXPECTED)}catch(t){throw e.createAnalyticsEvent({eventName:"recovery_oauth_error",payload:{error:t.toString(),provider:n}}),new s.a("Recovery OAuth failed")}[g,x]=await Promise.all([e.getAccessToken(),y({api:e.api,provider:n,codeVerifier:o,stateCode:t,authorizationCode:r})]);break}case"icloud":{let{url:t}=await f({api:e.api,provider:n});m(t);let{ckWebAuthToken:r}=await w({url:t,popup:h,provider:n});x=r,g=await e.getAccessToken()}}if(!t)throw new s.a("Cannot connect to wallet proxy");if(!g)throw new s.a("Unable to authorize user");switch(c){case"recover":{let r=a?.recoverWallet?.entropyId,o=a?.recoverWallet?.entropyIdVerifier;if(!r||!o)throw new s.a("Recovery OAuth failed");e.createAnalyticsEvent({eventName:"embedded_wallet_recovery_started",payload:{walletAddress:r,recoveryMethod:n}}),await t.recover({accessToken:g,entropyId:r,entropyIdVerifier:o,recoveryAccessToken:x}),e.createAnalyticsEvent({eventName:"embedded_wallet_recovery_completed",payload:{walletAddress:r,recoveryMethod:n}});break}case"create-wallet":{let t;if(e.createAnalyticsEvent({eventName:"embedded_wallet_creation_started"}),u&&v)t=await l({recoveryMethod:n,recoveryAccessToken:x,chainType:"ethereum",walletIndex:0,latestUser:o}),t=await l({chainType:"solana",walletIndex:0,latestUser:t.user});else if(v)t=await l({recoveryMethod:n,recoveryAccessToken:x,chainType:"solana",walletIndex:0,latestUser:o});else{if(!u)throw Error("Invalid args to create wallet");t=await l({recoveryMethod:n,recoveryAccessToken:x,chainType:"ethereum",walletIndex:0,latestUser:o})}if(!t)throw i("createWallet","onError",s.b.UNKNOWN_EMBEDDED_WALLET_ERROR),Error("Failed to create wallet");e.createAnalyticsEvent({eventName:"embedded_wallet_creation_completed",payload:{walletAddress:t.account.address}}),i("createWallet","onSuccess",{wallet:t.account});break}case"set-recovery":{let a=(0,d.g)(o);if(!a)throw i("setWalletRecovery","onError",s.b.EMBEDDED_WALLET_NOT_FOUND),Error("Embedded wallet not found");e.createAnalyticsEvent({eventName:"embedded_wallet_set_recovery_started",payload:{walletAddress:a.address,existingRecoveryMethod:a.recoveryMethod,targetRecoveryMethod:n}});let{entropyId:l,entropyIdVerifier:c}=(0,p.g)(o);await t.setRecovery({accessToken:g,entropyId:l,entropyIdVerifier:c,recoveryMethod:n,recoveryAccessToken:x});let h=(0,d.g)(await r());if(!h)throw i("createWallet","onError",s.b.UNKNOWN_EMBEDDED_WALLET_ERROR),Error("Failed to set recovery on wallet");e.createAnalyticsEvent({eventName:"embedded_wallet_set_recovery_completed",payload:{walletAddress:a.address,existingRecoveryMethod:a.recoveryMethod,targetRecoveryMethod:n}}),i("setWalletRecovery","onSuccess",{method:n,wallet:h});break}default:throw new s.a("Unsupported recovery action")}}}})(),[E,A]=(0,o.useState)(!1),{provider:C,action:b,isInAccountCreateFlow:j,shouldCreateEth:R,shouldCreateSol:k}=h?.recoveryOAuthStatus,[O,T]=(0,o.useState)(void 0),[S,L]=(0,o.useState)("create-wallet"===b);if("user-passcode"===C)throw Error("RecoveryOAuthScreen should never be called with a wallet that specifies recoveryMethod: `user-passcode`");let N=g[C].name,M=g[C].component,I=h?.recoverWallet?.onCompleteNavigateTo,U=new c.R(async(e="create-wallet")=>(L(!0),new Promise((t,r)=>{setTimeout(async()=>{try{let r=window.open();await _({provider:C,action:e,popup:r,shouldCreateEth:R,shouldCreateSol:k}),A(!0),t()}catch(t){T({message:`${"recover"===e?"Recovery":"Back up"} with ${N} unsuccessful`,detail:"recover"===b?`Please verify that you are selecting the ${N} account associated with your backup.`:"",retryable:!0}),r()}},0)})));(0,o.useEffect)(()=>{"recover"!==b&&U.execute(j?"create-wallet":"set-recovery")},[]),(0,o.useEffect)(()=>{if(!E)return;let a=setTimeout(()=>{j?(r({createWallet:{onSuccess:()=>{},onFailure:t=>{m({eventName:"embedded_wallet_creation_failure_logout",payload:{error:t,screen:"RecoveryOAuthScreen"}}),e()},callAuthOnSuccessOnClose:!0,shouldCreateEth:!1,shouldCreateSol:!1}}),t("EmbeddedWalletCreatedScreen")):x({shouldCallAuthOnSuccess:!1})},n.q);return()=>clearTimeout(a)},[E]);let D=(0,o.useCallback)(async()=>{await U.execute("recover"),I?t(I):A(!0)},[]),W="google-drive"===C?"Google Drive":"Apple iCloud",P=E&&`Successfully ${"recover"===b?"recovered":"backed up"} with ${W}.`||O&&O.message||`${"recover"===b?"Recovering":"Backing up"} with ${W}...`,F=O?O.detail:"";return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.M,{}),S?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(v.R,{children:[(0,a.jsx)(l.C,{title:P,icon:(0,a.jsx)(M,{style:{width:"38px",height:"38px"}}),description:F}),O&&O?.retryable?(0,a.jsx)(i.P,{onClick:()=>{(0,c.l)(),T(void 0),"create-wallet"===b?U.execute("create-wallet"):D()},disabled:!E&&!O?.retryable,children:"Try again"}):null]})}):(0,a.jsxs)(v.R,{children:[(0,a.jsx)(l.C,{title:"Confirm it's really you",icon:(0,a.jsx)(M,{style:{height:42,width:48}}),description:`To confirm your identity, please log in to ${W} where your account is backed up.`}),(0,a.jsxs)(i.P,{onClick:D,children:["Confirm with ",W]})]}),(0,a.jsx)(i.B,{})]})}}},64252:(e,t,r)=>{r.d(t,{C:()=>l,S:()=>i});var a=r(73788),o=r(78912);let i=({title:e,description:t,children:r,...o})=>(0,a.jsx)(n,{...o,children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h3",{children:e}),"string"==typeof t?(0,a.jsx)("p",{children:t}):t,r]})});(0,o.I4)(i)`
  margin-bottom: 24px;
`;let l=({title:e,description:t,icon:r,children:o,...i})=>(0,a.jsxs)(c,{...i,children:[r||null,(0,a.jsx)("h3",{children:e}),t&&"string"==typeof t?(0,a.jsx)("p",{children:t}):t,o]}),n=o.I4.div`
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: flex-start;
  text-align: left;
  gap: 8px;
  width: 100%;
  margin-bottom: 24px;

  && h3 {
    font-size: 17px;
    color: var(--privy-color-foreground);
  }

  /* Sugar assuming children are paragraphs. Otherwise, handling styling on your own */
  && p {
    color: var(--privy-color-foreground-2);
    font-size: 14px;
  }
`,c=(0,o.I4)(n)`
  align-items: center;
  text-align: center;
  gap: 16px;

  h3 {
    margin-bottom: 24px;
  }
`},99640:(e,t,r)=>{r.d(t,{A:()=>i,G:()=>l,R:()=>n,a:()=>c});var a=r(73788),o=r(78912);let i=e=>(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 21 20",...e,children:[(0,a.jsx)("path",{fill:"url(#icloud-gradient)",d:"M12.34 7.315a4.26 4.26 0 0 0-3.707 2.18 2.336 2.336 0 0 0-1.02-.236 2.336 2.336 0 0 0-2.3 1.963 3.217 3.217 0 0 0 1.244 6.181c.135-.001.27-.01.404-.029h8.943c.047.004.094.006.141.007.045-.001.09-.004.135-.007h.214v-.016a2.99 2.99 0 0 0 1.887-.988c.487-.55.757-1.261.757-1.998v-.006a3.017 3.017 0 0 0-.69-1.915 2.992 2.992 0 0 0-1.748-1.034 4.26 4.26 0 0 0-4.26-4.102Z"}),(0,a.jsx)("defs",{children:(0,a.jsxs)("linearGradient",{id:"icloud-gradient",x1:19.086,x2:3.333,y1:14.38,y2:14.163,gradientUnits:"userSpaceOnUse",children:[(0,a.jsx)("stop",{stopColor:"#3E82F4"}),(0,a.jsx)("stop",{offset:1,stopColor:"#93DCF7"})]})})]}),l=({style:e,...t})=>(0,a.jsxs)("svg",{width:"16",height:"14",style:e,viewBox:"0 0 16 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t,children:[(0,a.jsxs)("g",{clipPath:"url(#clip0_2115_829)",children:[(0,a.jsx)("path",{d:"M2.34709 12.9404L2.3471 12.9404L2.34565 12.938L1.64031 11.7448L1.64004 11.7444L0.651257 10.0677C0.640723 10.0496 0.630746 10.0314 0.621325 10.0129H4.16461L2.39424 13.0139C2.3775 12.9901 2.36178 12.9656 2.34709 12.9404Z",fill:"#0066DA",stroke:"#6366F1"}),(0,a.jsx)("path",{d:"M8 4.48713L5.47995 0.215332C5.23253 0.358922 5.02176 0.556358 4.87514 0.80764L0.219931 8.70508C0.076007 8.95094 0.000191627 9.22937 0 9.51277H5.04009L8 4.48713Z",fill:"#00AC47"}),(0,a.jsx)("path",{d:"M13.48 13.7847C13.7274 13.6411 13.9382 13.4437 14.0848 13.1924L14.3781 12.6988L15.7801 10.3206C15.9267 10.0693 16.0001 9.79114 16.0001 9.51294H10.9596L12.0321 11.577L13.48 13.7847Z",fill:"#EA4335"}),(0,a.jsx)("path",{d:"M8.00003 4.48718L10.5201 0.215385C10.2726 0.0717949 9.98857 0 9.69533 0H6.30472C6.01148 0 5.7274 0.0807692 5.47998 0.215385L8.00003 4.48718Z",fill:"#00832D"}),(0,a.jsx)("path",{d:"M10.9599 9.51294H5.04007L2.52002 13.7847C2.76744 13.9283 3.05152 14.0001 3.34476 14.0001H12.6552C12.9484 14.0001 13.2325 13.9194 13.4799 13.7847L10.9599 9.51294Z",fill:"#2684FC"}),(0,a.jsx)("path",{d:"M13.4525 4.75636L11.1249 0.80764C10.9782 0.556358 10.7675 0.358922 10.52 0.215332L8 4.48713L10.9599 9.51277H15.9908C15.9908 9.23456 15.9175 8.95636 15.7709 8.70508L13.4525 4.75636Z",fill:"#FFBA00"})]}),(0,a.jsx)("defs",{children:(0,a.jsx)("clipPath",{id:"clip0_2115_829",children:(0,a.jsx)("rect",{width:"16",height:"14",fill:"white"})})})]}),n=o.I4.div`
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding-top: 24px;
  padding-bottom: 24px;
`,c=o.I4.div`
  padding-bottom: 24px;
`}}]);