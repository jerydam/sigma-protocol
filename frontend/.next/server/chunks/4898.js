"use strict";exports.id=4898,exports.ids=[4898],exports.modules={34898:(a,b,c)=>{c.r(b),c.d(b,{MfaAuthVerifyFlowScreen:()=>i,default:()=>i});var d=c(66150),e=c(7719),f=c(50579),g=c(2808),h=c(59089);c(19078),c(11765),c(43132),c(30443),c(8752);let i={component:()=>{let{user:a}=(0,g.u)(),b=(0,f.u)(),c=(0,e.useMemo)(()=>a?.mfaMethods.filter(a=>"passkey"!==a||!b.globalDisablePasskeys)??[],[a?.mfaMethods,b.globalDisablePasskeys]),{data:i}=(0,g.a)(),[j,k]=(0,e.useState)(c[0]),[l,m]=(0,e.useState)(!1),[n,o]=(0,e.useState)(),[p,q]=(0,e.useState)();if((0,e.useEffect)(()=>{k(c[0])},[c]),!i?.mfaVerify)throw Error("Missing modal data for MFA verification screen.");let{onFailure:r,onSuccess:s,generateOptions:t,verifyTotpCode:u,verifyPasskey:v,verifySmsCode:w,sendSmsCode:x}=i.mfaVerify,y=async a=>{if("passkey"!==a)try{k(a),"sms"===a&&(k(a),await x()),"totp"===a&&k(a)}catch(a){console.error(a)}else try{k(a);let b=await t();if(!b)throw Error("something went wrong");o(b),await v(b),m(!0),q(void 0),s()}catch(a){q((0,h.t)(a))}},z=async a=>{q(void 0);try{if(!a||!j)return;if("passkey"===j){if(!n)throw Error("Missing passkey challenge");await v(n)}else"sms"===j?await w(a):"totp"===j&&await u(a);q(void 0),m(!0),s()}catch(a){throw(0,h.t)(a).error}},A=()=>{p||!l?r(p?.error??Error("Canceled MFA verification.")):s()},B=(0,e.useRef)(!1);return(0,e.useEffect)(()=>{!B.current&&j&&(B.current=!0,y(j).finally(()=>{B.current=!1}))},[open]),a?"passkey"===j?(0,d.jsx)(h.V,{account:a.linkedAccounts.filter(a=>"passkey"===a.type&&a.enrolledInMfa).sort((a,b)=>b.firstVerifiedAt.valueOf()-a.firstVerifiedAt.valueOf())[0],submitSuccess:l,hasBlockingError:p?.isBlocking??!1,error:p?.error,onClose:A,onBack:()=>{k(void 0),q(void 0)},handleSubmit:()=>z(n).catch(q)}):"sms"===j||"totp"===j?(0,d.jsx)(h.a,{selectedMethod:j,submitSuccess:l,hasBlockingError:p?.isBlocking??!1,handleSubmitCode:z,onClose:A,onBack:c.length>1?()=>k(void 0):void 0}):(0,d.jsx)(h.b,{mfaMethods:c,onSelect:y,handleClose:A}):null}}}};